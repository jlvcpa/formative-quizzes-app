<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interactive Learning Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
    }

    #login-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    #login-screen input {
      margin: 5px;
      padding: 8px;
      width: 200px;
    }

    .container {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      min-height: 100vh;
    }

    .quiz-panel {
      flex: 1;
      padding: 20px;
      text-align: center;
      max-width: 800px;
      margin: auto;
    }

    .review-sidebar {
      width: 300px;
      background-color: #ecf0f1;
      border-left: 1px solid #ccc;
      padding: 20px;
      overflow-y: auto;
      overflow-x: auto;
    }

    .question {
      background: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      text-align: left;
    }

    .feedback {
      margin-top: 10px;
      font-weight: bold;
    }

    button {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2980b9;
    }

    .performance {
      font-size: 1.2em;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .review-item {
      margin-bottom: 10px;
      padding: 8px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

    .review-item:hover {
      background-color: #dfe6e9;
    }

    #quote-message {
      font-size: 1.1em;
      color: #34495e;
      margin-bottom: 20px;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
    }

    #quote-message.visible {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .review-sidebar {
        width: 100%;
        border-left: none;
        border-top: 1px solid #ccc;
        max-height: 300px;
      }
    }
  </style>
</head>
<body>
  <div id="login-screen">
    <h2>üîê Login to Start</h2>
    <input type="text" id="username" placeholder="Enter username" />
    <input type="password" id="password" placeholder="Enter password" />
    <button onclick="login()">Login</button>
  </div>

  <div class="container" style="display:none;" id="main-app">
    <div class="quiz-panel">
      <h1>Interactive Learning Quiz</h1>
      <p id="quote-message">üåü Loading inspiration...</p>
      <div class="performance" id="performance-summary">Score: 0%<br>0 of 0 question(s)</div>

      <label for="topic-select">Filter by Topic:</label>
      <select id="topic-select" onchange="filterQuestions()"></select>

      <div style="margin-top: 10px;">
        <label><input type="radio" name="view-mode" value="sequential" checked onchange="setViewMode()"> Sequential</label>
        <label><input type="radio" name="view-mode" value="random" onchange="setViewMode()"> Random</label>
      </div>

      <button onclick="printSummary()">üñ®Ô∏è Print Summary</button>
      <div id="quiz-container"></div>
    </div>

    <div class="review-sidebar">
      <h2>üìù Marked for Review</h2>
      <div id="review-list"></div>
    </div>
  </div>

  <script>
    const questions = [
      {
        text: "QuestionT1?",
        topic: "Topic1",
        options: ["Option1", "Option2", "Option3", "Option4"],
        correct: 1,
        explanation: "‚úÖ Correct."
      },
      {
        text: "QuestionT2?",
        topic: "Topic2",
        options: ["Option1", "Option2", "Option3", "Option4"],
        correct: 1,
        explanation: "‚úÖ Correct."
      },
      {
        text: "QuestionT3?",
        topic: "Topic2",
        options: ["Option1", "Option2", "Option3", "Option4"],
        correct: 1,
        explanation: "‚úÖ Correct."
      }
    ];

    let currentQuestionIndex = 0;
    let answeredCount = 0;
    let correctCount = 0;
    let markedForReview = [];
    let currentUser = "";
    let filteredQuestions = [...questions];
    let viewMode = "sequential";
    let quoteCache = [];

    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username || !password) {
        alert("Please enter both username and password.");
        return;
      }

      currentUser = username;
      localStorage.setItem("user_" + username, JSON.stringify({ password }));

      const saved = JSON.parse(localStorage.getItem("progress_" + username));
      if (saved) {
        answeredCount = saved.answeredCount;
        correctCount = saved.correctCount;
        markedForReview = saved.markedForReview || [];
      }

      document.getElementById("login-screen").style.display = "none";
      document.getElementById("main-app").style.display = "flex";
      populateTopicDropdown();
      filterQuestions();
      updatePerformance();
      renderReviewList();
      showQuestion(currentQuestionIndex);
    }

    function populateTopicDropdown() {
      const select = document.getElementById("topic-select");
      const topics = [...new Set(questions.map(q => q.topic))];
      select.innerHTML = `<option value="all">All Topics</option>` +
        topics.map(topic => `<option value="${topic}">${topic}</option>`).join("");
    }

    function filterQuestions() {
      const topic = document.getElementById("topic-select").value;
      filteredQuestions = topic === "all"
        ? [...questions]
        : questions.filter(q => q.topic === topic);
      applyViewMode();
    }

    function setViewMode() {
      const selected = document.querySelector('input[name="view-mode"]:checked');
      viewMode = selected ? selected.value : "sequential";
      applyViewMode();
    }

    function applyViewMode() {
      filteredQuestions = viewMode === "random"
        ? shuffle([...filteredQuestions])
        : [...filteredQuestions];
      currentQuestionIndex = 0;
      showQuestion(currentQuestionIndex);
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    async function fetchQuote() {
      const quoteEl = document.getElementById("quote-message");
      quoteEl.classList.remove("visible");

      if (quoteCache.length > 0) {
        const quote = quoteCache.shift();
        quoteEl.textContent = `üåü ${quote}`;
        quoteEl.classList.add("visible");
        return;
      }

      try {
        const response = await fetch("https://api.quotable.io/random?tags=inspirational|education|wisdom");
        const data = await response.json();
        quoteCache.push(data.content);
        quoteEl.textContent = `üåü ${data.content}`;
        quoteEl.classList.add("visible");
      } catch {
        quoteEl.textContent = "üåü Keep going‚Äîyour effort matters!";
        quoteEl.classList.add("visible");
      }
    }

    function showQuestion(index) {
      currentQuestionIndex = index;
      const q = filteredQuestions[index];
      const container = document.getElementById("quiz-container");

      fetchQuote(); // üåü Fetch a new inspirational quote

      container.innerHTML = `<div class="question">
        <h2>Question ${index + 1}</h2>
        <p>${q.text}</p>
        ${q.options.map((opt, i) => {
          const choiceLabel = String.fromCharCode(65 + i);
          return `
            <div style="margin-bottom: 8px;">
              <label>
                <input type="radio" name="q${index}" value="${i}" style="margin-right: 8px;" />
                <strong>${choiceLabel}.</strong> ${opt}
              </label>
            </div>
          `;
        }).join("")}
        <div class="feedback" id="feedback-${index}"></div>
        <button onclick="checkAnswer(${index})">Check Answer</button>
        <button onclick="markForReview(${index})">üìù Mark for Review</button>
        ${markedForReview.includes(index) ? `<button onclick="unmarkReview(${index})">‚úÖ Marked as Reviewed</button>` : ""}
        ${index > 0 ? `<button onclick="showQuestion(${index - 1})">Previous</button>` : ""}
        ${index < filteredQuestions.length - 1 ? `<button onclick="showQuestion(${index + 1})">Next</button>` : ""}
      </div>`;
    }

    function checkAnswer(index) {
      const q = filteredQuestions[index];
      const selected = document.querySelector(`input[name="q${index}"]:checked`);
      const feedback = document.getElementById(`feedback-${index}`);

      if (!selected) {
        feedback.textContent = "Please select an answer.";
        feedback.style.color = "orange";
        return;
      }

      const selectedIndex = parseInt(selected.value);
      const isCorrect = selectedIndex === q.correct;

      feedback.textContent = isCorrect
        ? "‚úÖ Correct! " + q.explanation
        : "‚ùå Incorrect. " + q.explanation;
      feedback.style.color = isCorrect ? "green" : "red";

      answeredCount++;
      if (isCorrect) correctCount++;

      updatePerformance();
      saveProgress();
    }

    function updatePerformance() {
      const percent = answeredCount ? Math.round((correctCount / answeredCount) * 100) : 0;
      document.getElementById("performance-summary").innerHTML =
        `Score: ${percent}%<br>${correctCount} of ${answeredCount} question(s)`;
    }

    function markForReview(index) {
      if (!markedForReview.includes(index)) {
        markedForReview.push(index);
        renderReviewList();
        saveProgress();
        showQuestion(index);
      }
    }

    function unmarkReview(index) {
      markedForReview = markedForReview.filter(i => i !== index);
      renderReviewList();
      saveProgress();
      showQuestion(index);
    }

    function renderReviewList() {
      const list = document.getElementById("review-list");
      list.innerHTML = markedForReview.map(i => {
        return `<div class="review-item" onclick="showQuestion(${i})">
          Question ${i + 1}: ${questions[i].text}
        </div>`;
      }).join("");
    }

    function saveProgress() {
      const data = {
        answeredCount,
        correctCount,
        markedForReview
      };
      localStorage.setItem("progress_" + currentUser, JSON.stringify(data));
    }

    function printSummary() {
      const percent = answeredCount ? Math.round((correctCount / answeredCount) * 100) : 0;
      const summary = `
Performance Summary for ${currentUser}

Score: ${percent}%
${correctCount} of ${answeredCount} question(s)

Marked for Review:
${markedForReview.map(i => ` - Question ${i + 1}: ${questions[i].text}`).join("\n")}
      `;

      const printWindow = window.open("", "_blank");
      printWindow.document.write(`<pre>${summary}</pre>`);
      printWindow.document.close();
      printWindow.print();
    }
  </script>
</body>
</html>